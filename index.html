<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Valentine Card ‚ù§Ô∏è</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body{
  font-family: Arial;
  background:#ffe6ec;
  text-align:center;
  margin:0;
  overflow-x:hidden;
}

h1{margin-top:30px}

.btn{
  background:#ff5c8a;
  color:white;
  padding:10px 18px;
  border:none;
  border-radius:8px;
  margin:6px;
  cursor:pointer;
}

textarea{
  width:80%;
  height:100px;
  border-radius:10px;
  padding:10px;
}

.gallery img{
  width:100px;
  margin:6px;
  border-radius:10px;
}

#map{
  height:350px;
  margin:20px;
  border-radius:12px;
}

.heart{
  position:fixed;
  top:-10px;
  color:#ff5c8a;
  animation:fall 6s linear infinite;
}

@keyframes fall{
  to{transform:translateY(110vh)}
}

.popup{
  display:none;
  position:fixed;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  background:white;
  padding:20px;
  border-radius:12px;
  box-shadow:0 0 20px rgba(0,0,0,.3);
}
</style>
</head>

<body>

<h1>üíñ Valentine Greeting üíñ</h1>

<button class="btn" onclick="toggleMusic(event)">üéµ Play Music</button>

<label class="btn">
Change Song
<input type="file" id="musicUpload" accept="audio/*" hidden>
</label>

<button class="btn" onclick="showPoem()">‚ú® Secret Poem</button>

<audio id="music" src="music.mp3"></audio>

<br><br>

<h2>Your Message</h2>
<textarea id="msg" placeholder="Tulis pesan cinta..."></textarea>

<h2>Photo Gallery</h2>
<input type="file" id="photos" multiple accept="image/*">
<div class="gallery" id="gallery"></div>

<h2>Memory Map</h2>
<div id="map"></div>
<button class="btn" onclick="clearMarkers()">Clear Memories</button>

<!-- poem popup -->
<div class="popup" id="poem">
<p>
Aku mungkin jauh,<br>
tapi hatiku selalu di kamu.<br><br>
Setiap hari nunggu ketemu,<br>
karena kamu rumahku ‚ù§Ô∏è
</p>
<button onclick="closePoem()">Close</button>
</div>

<script>
/* ================= MUSIC ================= */
const music=document.getElementById("music");
function toggleMusic(e){
 if(music.paused){
   music.play();
   e.target.innerText="‚è∏ Pause Music";
 }else{
   music.pause();
   e.target.innerText="üéµ Play Music";
 }
}

document.getElementById("musicUpload").addEventListener("change",e=>{
 const file=e.target.files[0];
 if(file){
   music.src=URL.createObjectURL(file);
   music.play();
 }
});

/* ================= MESSAGE SAVE ================= */
const msg=document.getElementById("msg");
msg.value=localStorage.getItem("msg")||"";
msg.oninput=()=>localStorage.setItem("msg",msg.value);

/* ================= GALLERY ================= */
const gallery=document.getElementById("gallery");
document.getElementById("photos").onchange=e=>{
 gallery.innerHTML="";
 for(let f of e.target.files){
  const img=document.createElement("img");
  img.src=URL.createObjectURL(f);
  gallery.appendChild(img);
 }
};

/* ================= MAP ================= */
const map=L.map('map').setView([-6.2,106.8],10);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png')
.addTo(map);

let markers=[];

const saved=JSON.parse(localStorage.getItem("markers")||"[]");

saved.forEach(c=>{
 const m=L.marker(c).addTo(map);
 markers.push(m);
});

map.on('click',e=>{
 const m=L.marker(e.latlng).addTo(map);
 markers.push(m);
 saveMarkers();
});

function saveMarkers(){
 const arr=markers.map(m=>m.getLatLng());
 localStorage.setItem("markers",JSON.stringify(arr));
}

function clearMarkers(){
 markers.forEach(m=>map.removeLayer(m));
 markers=[];
 saveMarkers();
}

/* ================= POEM ================= */
function showPoem(){
 document.getElementById("poem").style.display="block";
}
function closePoem(){
 document.getElementById("poem").style.display="none";
}

/* ================= HEART EFFECT ================= */
setInterval(()=>{
 const h=document.createElement("div");
 h.className="heart";
 h.innerText="‚ù§Ô∏è";
 h.style.left=Math.random()*100+"vw";
 document.body.appendChild(h);
 setTimeout(()=>h.remove(),6000);
},500);
</script>

</body>
</html>
