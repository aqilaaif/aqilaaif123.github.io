<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Valentine Card ‚ù§Ô∏è</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
body{
  margin:0;
  font-family:Georgia,serif;
  background:linear-gradient(#ffd6e0,#ffeef2);
  text-align:center;
  overflow-x:hidden;
}

/* falling hearts */
.heart{
  position:fixed;
  top:-10px;
  font-size:20px;
  animation:fall linear infinite;
  opacity:.6;
}
@keyframes fall{
  to{transform:translateY(110vh);}
}

/* envelope */
.envelope{
  width:280px;
  height:180px;
  margin:30px auto;
  background:#fff;
  border-radius:12px;
  cursor:pointer;
  position:relative;
  box-shadow:0 10px 25px rgba(0,0,0,.2);
}
.flap{
  position:absolute;
  width:100%;
  height:100%;
  background:#f8c8d6;
  transform-origin:top;
  transition:.7s;
}
.open .flap{ transform:rotateX(180deg); }

.message{
  padding:20px;
  opacity:0;
  font-family:cursive;
  font-size:18px;
}
.open .message{ opacity:1; }

/* buttons */
button{
  margin:8px;
  padding:8px 14px;
  border:none;
  border-radius:8px;
  background:#ff4d6d;
  color:#fff;
  cursor:pointer;
}

/* gallery */
.gallery img{
  width:90px;
  height:90px;
  object-fit:cover;
  border-radius:12px;
  margin:5px;
}
.border1{border:6px solid pink;}
.border2{border:6px dashed red;}
.border3{border:6px double hotpink;}

#map{
  height:260px;
  margin:20px;
  border-radius:12px;
}
</style>
</head>

<body>

<h1>üíå Valentine Greeting</h1>

<input id="userMsg" placeholder="Type your love message..." style="width:80%;padding:8px"><br>

<div id="envelope" class="envelope">
  <div class="flap"></div>
  <div class="message" id="displayMsg"></div>
</div>

<button id="musicBtn" onclick="toggleMusic()">üéµ Play Music</button>
<button onclick="generatePoem()">‚ú® Secret Poem</button>

<h3 id="countdown"></h3>

<hr>

<h2>Photo Gallery</h2>
<input type="file" multiple onchange="loadPhotos(event)">
<br>
<select onchange="changeBorder(this.value)">
  <option value="">Border Style</option>
  <option value="border1">Pink</option>
  <option value="border2">Dashed</option>
  <option value="border3">Double</option>
</select>

<div id="gallery" class="gallery"></div>

<hr>

<h2>Memory Map</h2>
<div id="map"></div>
<button onclick="clearMarkers()">Clear Memories</button>

<audio id="music" loop>
<source src="https://cdn.pixabay.com/audio/2022/03/15/audio_c8d7f3c9d8.mp3">
</audio>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
/* ================= HEARTS ================= */
for(let i=0;i<30;i++){
  let h=document.createElement("div");
  h.innerHTML="‚ù§Ô∏è";
  h.className="heart";
  h.style.left=Math.random()*100+"vw";
  h.style.animationDuration=4+Math.random()*6+"s";
  document.body.appendChild(h);
}

/* ================= MESSAGE ================= */
const env=document.getElementById("envelope");
const input=document.getElementById("userMsg");
const display=document.getElementById("displayMsg");

input.value = localStorage.getItem("loveMsg") || "";

env.onclick=()=>{
  const msg=input.value;

  display.innerText=msg;
  localStorage.setItem("loveMsg",msg);

  env.classList.toggle("open");

  /* auto play music when open */
  if(music.paused){
    music.play();
    musicBtn.innerText="‚è∏ Pause Music";
  }
}

/* ================= MUSIC ================= */
const music=document.getElementById("music");
const musicBtn=document.getElementById("musicBtn");

music.volume=0.6;

function toggleMusic(){
  if(music.paused){
    music.play();
    musicBtn.innerText="‚è∏ Pause Music";
  }else{
    music.pause();
    musicBtn.innerText="üéµ Play Music";
  }
}

/* ================= POEM ================= */
function generatePoem(){
  alert("Your smile lights my darkest nights,\nEvery heartbeat whispers your name,\nForever with you ‚ù§Ô∏è");
}

/* ================= COUNTDOWN ================= */
function updateCountdown(){
  const target=new Date("Feb 14, 2026 00:00:00").getTime();
  const diff=target-Date.now();
  if(diff<0)return;

  const d=Math.floor(diff/86400000);

  document.getElementById("countdown").innerText=
  "‚è≥ "+d+" days until Valentine's Day";
}
setInterval(updateCountdown,1000);

/* ================= GALLERY ================= */
function loadPhotos(e){
  const g=document.getElementById("gallery");

  for(let file of e.target.files){
    const img=document.createElement("img");
    img.src=URL.createObjectURL(file);
    g.appendChild(img);
  }
}

function changeBorder(b){
  document.getElementById("gallery").className="gallery "+b;
}

/* ================= MAP ================= */
const map=L.map('map').setView([-6.2,106.8],11);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png')
.addTo(map);

let markers=JSON.parse(localStorage.getItem("markers"))||[];

/* load saved */
markers.forEach(pos=>{
  L.marker(pos).addTo(map).bindPopup("Our memory ‚ù§Ô∏è");
});

/* add marker */
map.on('click',function(e){
  const pos=[e.latlng.lat,e.latlng.lng];

  L.marker(pos).addTo(map).bindPopup("Our memory ‚ù§Ô∏è");

  markers.push(pos);

  localStorage.setItem("markers",JSON.stringify(markers));
});

/* clear */
function clearMarkers(){
  localStorage.removeItem("markers");
  location.reload();
}
</script>

</body>
</html>
